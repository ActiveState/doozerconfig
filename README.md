TODO: extract this as a separate library
